# ICG(Impartial Combinatorial Games): 公平组合游戏
游戏有两个人参与，二者轮流做出决策。且这两个人的决策都对自己最有利。
当有一人无法做出决策时游戏结束，无法做出决策的人输。无论二者如何做出决策，游戏可以在有限步内结束。
游戏中的同一个状态不可能多次抵达。且游戏不会有平局出现。
任意一个游戏者在某一确定状态可以作出的决策集合只与当前的状态有关，而与游戏者无关。

将状态视为一个点，决策视为一条边，可以将游戏转化为有向无环图。


## SG(Sprague-Grundy)函数
SG(u) = mex{SG(v), v$\rightarrow$u}，mex：集合中没有出现的最小自然数；v$\rightarrow$u：可以从 v 状态转移到 u 状态。  
叶子节点即必败态的 $SG=0$。对于任意一个必胜态 $SG\not ={0}$，存在一个后继态$SG=0$。  
### SG定理
若局面 X 由若干个子游戏$X_1、X_2...X_n$构成，则$SG(X)=SG(X_1)\bigoplus{SG(X_2)}\bigoplus{...}\bigoplus{SG(X_n)}$  

对于符合可以求得SG函数的并且符合SG定理的游戏，可以通过打表找出总游戏的算数周期性，然后判断是否先手必胜（SG!=0）/必败（SG=0）

## Nim Game(异或理论)
有 N 堆石子，每堆有$a_i$个，双方轮流取石子。每次只能从一堆中取任意数量的石子，但不能不取。取走最后一个石子者获胜（决策集合为空者输）。  
考虑单独的每个堆石子数为i时，$SG(1)=1$ ... $SG(n)=n$（可以将每个状态分为若干个状态直至不能划分成为一颗树状结构，然后递归由SG函数的定义得到SG(x)的值）    
Nim游戏显然符合SG定理（N个堆可以当作N个子游戏），由`SG定理`可得当$a_1\bigoplus{a_2}\bigoplus{...}\bigoplus{a_n}=0$时，先手必败（开始状态就是必败态）。
### NimK游戏
每人每次可以从[1, d]堆中各取任意多个石子。  
将每堆石子数用二进制表示，对于二进制的任意一位，如果这一位为 1 的石子堆数 %(d+1) 都得0，那么先手必败，否则先手必胜。


## 树上删边游戏
给出一个N个点的有根树。  
游戏者轮流从树中删去边，删去一条边后，不与根节点相连的部分将被移走。  
无边可删者输。  
（和删除一个点及以它为根的子树类似）  

叶子节点的$SG=0$；  
中间节点的$SG(u)=(SG(v_1)+1)\bigoplus{(SG(v_2)+1)}\bigoplus{...}\bigoplus(SG(v_n)+1)$，$v_i$是u的子节点。
### 克朗原理
对于树上的一个点，可以将其各个分支（每个子树都是一个链）转化为一根以此点为根的链，链的长度就是各个分支的边的数量的异或和。   

显然可以从叶子节点开始处理，将树上删边游戏转化为Nim游戏。

### 费森原理
环上的点可以融合，且不改变图的SG值
### 无向图的删边游戏
一个无相联通图，有一个点作为图的根。  
游戏者轮流从图中删去边，删去一条边后，不与根节点相连的部分将被移走。  
谁无路可走谁输。  

可以通过`费森原理`将图中的任意一个偶环缩成一个新点，任意一个奇环缩成一个新点加一个新边；所有连到原先环上的边全部改为与新点相连。这样的改动不会影响图的SG值。  
这样就可以当作树上删边游戏来处理。


## Anti-SG(反Nim博弈)
决策集合为空者赢，其它规则与SG游戏(Nim游戏)相同。 
### SJ定理
对于一个Anti-SG游戏，当局面中所有的单一游戏的SG值为0时游戏结束。  
先手必胜：  
1. 游戏的$SG=0$，且游戏中没有单一游戏的$SG>1$；
2. 游戏的$SG\not =0$，且游戏中任意单一游戏的$SG>1$。


## Multi-SG
Multi-SG 游戏规定，在符合拓扑原则的前提下，一个单一游戏的后继可以为多个单一游戏。  
其它规则与SG游戏相同（也就是存在把一个子游戏拆成多个子游戏的操作）。
$$ SG(x)=\left\{
\begin{array}{rcl}
x-1       &      & {x \pmod 4 = 0}\\\\
x     &      & {x \pmod 4 = 1 | 2}\\\
x+1     &      & {x \pmod 4 = 3}\\\\
\end{array} \right. $$


## Bash Game(巴什博弈)(同余理论)
只有 一堆 n个物品，两个人轮流从这堆物品中取物，规定每次至少取一个，最多取m个，最后取光者得胜。  
当n=m+1，那么由于一次最多只能取m个，所以，无论先取者拿走多少个，后取者都能够一次拿走剩余的物品，后者胜。  

因此：如果n=（m+1）r+s，（r为任意自然数，0<s≤m),那么先取者要拿走s个物品，如果后取者拿走k（k≤m)个，那么先取者再拿走m+1-k个，结果剩下（m+1）（r-1）个，以后保持这样的取法，那么先取者肯定获胜。  
综上，如果$n \pmod{(m + 1)}=0$，先手必败，否则先手必胜。


## Wythoff’s Game(威佐夫博弈)(黄金分割)
两个顶尖聪明的人在玩游戏，有2堆石子，每人每次可以拿走任意一堆中任意数量的石子或在两堆石子中拿走相同数量的石子，不能拿的人输，请问先手与后手谁必胜？  

第 k 个奇异局势是$(\lfloor{\frac{1+\sqrt{5}}{2}}k\rfloor,\lfloor{\frac{3+\sqrt{5}}{2}}k\rfloor)$，$k=y-x$。（奇异局势是先手必败的局势）  
只需要将 k 带入后判断得到的x，y是否是输入的x，y即可。


## Ferguson游戏(清空分割游戏)
有两个盒子，一个装有 m 颗糖，一个装有 n 颗糖，表示为 (m, n)。  
每次清空一个盒子，将另一个盒子里的糖转移一些过来，并保证两个盒子至少各有一颗糖。  
最后进行转移糖者胜，无法转移糖者败。  

m, n 都为奇数，先手败；m, n 至少一个为偶数，先手胜。


## 约数游戏
桌上有 n 个数字：1~n。  
两人轮流在选择一个桌上的数 x ，然后将 x 与 x 的约数都拿走。  
拿去最后一个数的人胜出（无法选择数字的人失败）。  

先手必胜。


## 斐波那契博弈
两个顶尖聪明的人在玩游戏，有一堆石子，先手第一次可以拿任意多个但不能全拿走也不能不拿，之后每个人最少拿一个，最多拿前一个人两倍那么多个，谁取到最后一个谁就能获胜，请问先手后手谁必胜？  

石子数为斐波那契数时先手必败，反之先手必胜。